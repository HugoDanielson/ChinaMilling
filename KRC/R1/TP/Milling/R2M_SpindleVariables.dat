&ACCESS RV1
DEFDAT  R2M_SPINDLEVARIABLES PUBLIC

;FOLD USED Signals
GLOBAL SIGNAL DI_MillQuitMessageByPLC $IN[601]
GLOBAL SIGNAL DO_PulseTCOpenCover $OUT[4094] ; Toolchanger open cover pulse
GLOBAL SIGNAL DO_PulseTCCloseCover $OUT[4095] ; Toolchanger close cover pulse

; Localization Frequency converter control words 
GLOBAL SIGNAL oFreqconverterCtlw $OUT[101]  TO $OUT[116] ; instead of cw in sps 
GLOBAL SIGNAL oSpindleOperMode $OUT[117]  TO $OUT[124]
GLOBAL SIGNAL oConverterSetSpeed $OUT[601]  TO $OUT[616]
GLOBAL SIGNAL iSpindleOperMode $IN[200]  TO $IN[207]
GLOBAL SIGNAL iConverterStatus $IN[208]  TO $IN[223]
GLOBAL SIGNAL gDISpindleActSpeed $IN[224]  TO $IN[239]
GLOBAL SIGNAL gDOProductNumber $OUT[1]  TO $OUT[8]

;ENDFOLD (Signals)

;FOLD USED TIMER / CONST
GLOBAL CONST INT cTimTemp=1 ; Timer For Temp Functions
GLOBAL CONST INT cTimMill=2 ; Timer For Milling Functions
GLOBAL CONST INT CTimToolChanger=3 ; Timer To Open The Cover
GLOBAL CONST INT CTimSpindleWarmUp=4 ; Timer For Spindle Warm Up

GLOBAL CONST REAL crTimeFrequency=8000.00
GLOBAL CONST REAL crTimeSpindleStand=9000.00
GLOBAL CONST REAL crTimeWarmUpState1=120.000
GLOBAL CONST REAL crTimeWarmUpState2=120.000
GLOBAL CONST REAL crTimeWarmUpState3=60.0000
GLOBAL CONST REAL crTempTime=5000.00
DECL GLOBAL FRAME USERBASE ; Save Base for CNC
;------- Usage Global Interrupts ----------
GLOBAL CONST INT cItrMillError=8 ; Interrupt For Milling System
GLOBAL CONST INT cItrMillWarning=9 ; Interrupt For Milling System
;------- Usage Cyclflags ------------------
GLOBAL CONST INT cCycMillError=8 ; Cyclflag For Milling System
GLOBAL CONST INT cCycMillWarning=9 ; Cyclflag For Milling System
GLOBAL CONST INT cCycMillSystemReady=10 ; Cyclflag For System Ready
GLOBAL CONST INT cCycMillSystem=11 ; Cyclflag For Milling System
GLOBAL CONST INT cCycMsg=18 ; Cyclflag For Delet Messages

GLOBAL ENUM TYPCoverTyp WAITFOR,DONTWAITFOR
GLOBAL ENUM TYPMillDirection CLOCKWISE,COUNTERCLOCKWISE
GLOBAL ENUM TYPMillReaction IMSTOP,FBSTOP,RESTART
GLOBAL ENUM TYPUtecTrigger OnTheFly,AfterNextPoint,None,Standing,Continuous
GLOBAL ENUM TYPCoverState OpenCover,CloseCover
GLOBAL ENUM TYPChillerState ChillerOn,ChillerOff
GLOBAL ENUM TYPSpindleToolReaction RELEASE,CLAMP,CLAMPWITHTOOL
GLOBAL ENUM TYPSpindleOverride BLOCKED,ALLOWED
GLOBAL ENUM TYPAir MAINAIRON,MAINAIROFF,BLOWAIRON,BLOWAIROFF
DECL GLOBAL TYPMillReaction geReactionRob=#RESTART
;ENDFOLD (Timer, Flags)  

;FOLD USED VARIABLES
GLOBAL BOOL gbMillProcessActive=FALSE
GLOBAL BOOL gbMillingAborted=FALSE
GLOBAL BOOL gbSimulationModeActive=FALSE
GLOBAL INT gnMillMemFrequency=-1000
GLOBAL INT gnSpindleActTool=1
GLOBAL INT gnInputOffsetTool=1264 ; input of the first tool (toolchanger)
;ENDFOLD (USED VARIABLES)

;Milling Localization variables 
GLOBAL INT gISetSpeed=0
GLOBAL INT gIActSpeed=0
GLOBAL INT giSpindlespeedchecksum=0
GLOBAL BOOL gbRobControlActive=FALSE
GLOBAL BOOL gbRobControlEnable=FALSE
GLOBAL BOOL gbRobControlRequest=FALSE
GLOBAL BOOL gbMillSystemWarning=FALSE
GLOBAL BOOL gbDirectionClockwise=TRUE

GLOBAL INT oMinSpindleRpm=0 ;for test
GLOBAL INT oMaxSpindleRpm=8600 ;for test

;FOLD /+/ UTEC LANGUAGE ### KONFIG ###
GLOBAL ENUM TYPMillMessage DIALOG,QUIT,STATE,STATE_CLEAR,NOTIFY,WAITING
GLOBAL ENUM TYPMillLanguage GERMAN,ENGLISH,FRENCH,SPANISH,TURKEY
;***ENUM TYPMillMessage DIALOG,QUIT,STATE,STATE_CLEAR,NOTIFY,WAITING

; ---------------------------------------------
; - Auswahl der Sprache fuer Meldungsbaustein -
; - Auswahl:                                  -
; -  #GERMAN  = Deutsch (Standard)            -
; -  #ENGLISH = Englisch                      -
; -  #FRENCH  = Franzoessisch                 -
; -  #SPANISH = Spanisch                      -
; -  #TURKEY  = Tuerkisch                     -
; ---------------------------------------------
; # UTEC - Language #
DECL GLOBAL TYPMillLanguage MILL_LANGUAGE=#ENGLISH
GLOBAL BOOL gbMillErrorMsgPresent=FALSE
GLOBAL BOOL gbMillOptionMsgQuit=TRUE
GLOBAL BOOL gbMillMsgQuitbyPLC=FALSE
GLOBAL INT gnMillMsgAnswer=1

DECL GLOBAL KRLMSG_T Meine_Meldung
DECL GLOBAL KRLMSGPAR_T Meine_Parameter[3]
DECL GLOBAL KRLMSGOPT_T Meine_Option
DECL GLOBAL KRLMSGDLGSK_T Meine_SK[7]
GLOBAL INT Ergebnis,Antwort
;ENDFOLD (Language)

ENDDAT